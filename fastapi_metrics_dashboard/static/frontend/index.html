<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fastapi Metrics Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <style type="text/tailwindcss">
        @layer base {
            button,
            [role='button'] {
                cursor: pointer;
            }
        }
        @layer utilities {
            .flex-center {
                @apply flex justify-center items-center
            }
            .graph_title {
                @apply py-3 px-4 text-xs text-zinc-400
            }
            .graph_container {
                @apply bg-zinc-950/80 border border-zinc-800 w-full h-72 rounded
            }
            .section_title {
                @apply px-6 py-3 pt-6 text-base text-zinc-200 gap-2 flex items-center
            }
            .section_container {
                @apply grid grid-cols-2 lg:grid-cols-4 gap-2 px-2
            }
            .fitler_button {
                @apply text-zinc-200
            }
            .text-xxs {
                font-size: 0.625rem; /* 10px */
                line-height: 0.875rem; /* 14px */
            }
        }
    </style>
</head>

<body style="background-color: black;">
    <div id="app">
        <div class="px-2 font-mono text-xs text-white bg-black">
            <!-- topbar -->
            <div class="flex justify-between px-4 py-4">
                <h1 class="py-1 px-2 rounded flex gap-2 items-center">
                    <!-- TODO: ability to replace this with user's own project title and icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 rounded-full p-1  text-white bg-[#10B981]"
                        viewBox="0 0 24 24"><!-- Icon from Material Symbols by Google - https://github.com/google/material-design-icons/blob/master/LICENSE -->
                        <path fill="currentColor" d="M3.5 18.5L2 17l7.5-7.5l4 4l7.1-8L22 6.9l-8.5 9.6l-4-4z" />
                    </svg>
                    <p class="text-2xl font-sans text-[#10B981]">FastAPI Metrics Dashboard</p>
                </h1>
            </div>
            <!-- filters and status bar -->
            <div
                class="fixed z-50 w-min bottom-5 left-1/2 -translate-x-1/2 whitespace-nowrap flex bg-zinc-900 px-4 py-2 rounded border border-zinc-800 gap-2">
                <p class="animate-pulse text-[#10B981] font-bold">live</p>
                <button>last 30 min</button>
                <button>something</button>
                <button>Refresh</button>
            </div>
            <!-- system metrics -->
            <div>
                <div class="flex justify-between">
                    <p class="section_title">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6"
                            viewBox="0 0 36 36"><!-- Icon from Clarity by VMware - https://github.com/vmware/clarity-assets/blob/master/LICENSE -->
                            <path fill="currentColor" d="M23.08 23.07h-11v1.5h11.75a.75.75 0 0 0 .75-.75V11.33h-1.5Z"
                                class="clr-i-outline clr-i-outline-path-1" />
                            <path fill="currentColor"
                                d="M32.2 18.15a.8.8 0 1 0 0-1.6H30v-5.4h2.2a.8.8 0 1 0 0-1.6H30V8.1A2.1 2.1 0 0 0 27.9 6h-1.55V3.8a.8.8 0 1 0-1.6 0V6h-5.4V3.8a.8.8 0 1 0-1.6 0V6h-5.4V3.8a.8.8 0 1 0-1.6 0V6H8.1A2.1 2.1 0 0 0 6 8.1v1.45H3.8a.8.8 0 1 0 0 1.6H6v5.4H3.8a.8.8 0 1 0 0 1.6H6v5.4H3.8a.8.8 0 1 0 0 1.6H6v2.75A2.1 2.1 0 0 0 8.1 30h2.65v2.2a.8.8 0 1 0 1.6 0V30h5.4v2.2a.8.8 0 1 0 1.6 0V30h5.4v2.2a.8.8 0 1 0 1.6 0V30h1.55a2.1 2.1 0 0 0 2.1-2.1v-2.75h2.2a.8.8 0 1 0 0-1.6H30v-5.4ZM28 27.9a.1.1 0 0 1-.1.1H8.1a.1.1 0 0 1-.1-.1V8.1a.1.1 0 0 1 .1-.1h19.8a.1.1 0 0 1 .1.1Z"
                                class="clr-i-outline clr-i-outline-path-2" />
                            <path fill="none" d="M0 0h36v36H0z" />
                        </svg>
                        System Metrics
                    </p>
                    <div class="flex items-center gap-2 whitespace-nowrap pr-2">
                        <div class="flex items-center pr-3 border rounded w-min bg-zinc-950/80 border-zinc-800">
                            <p class="graph_title">Number of threads</p>
                            <p class="text-sm text-white">4</p>
                        </div>
                    </div>
                </div>
                <div class="section_container">
                    <div class="graph_container">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="graph_title">CPU usage (%)</p>
                                <div class="flex text-xxs px-4 -mt-3 text-zinc-600 items-center gap-1">
                                    <div class="rounded bg-[#0d9568] w-1 h-2"></div>
                                    min
                                    <div class="rounded bg-[#10B981] w-1 h-2 ml-2"></div>
                                    avg
                                    <div class="rounded bg-[#13dd9a] w-1 h-2 ml-2"></div>
                                    max
                                </div>
                            </div>
                            <p class="px-5 text-sm text-zinc-300">{{ current_cpu_usage }} <span
                                    class="text-zinc-500">%</span></p>
                        </div>
                        <div id="cpu_chart" class="w-full h-full"></div>
                    </div>
                    <div class="graph_container">
                        <div class="flex items-center justify-between">
                            <p class="graph_title">Memory usage (%)</p>
                            <p class="px-5 text-sm text-zinc-300">{{ current_memory_usage }} <span
                                    class="text-zinc-500">%</span></p>
                        </div>
                        <div id="memory_chart" class="w-full h-full"></div>
                    </div>
                    <div class="graph_container">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="graph_title">Memory usage (MiB)</p>
                                <div class="flex text-xxs px-4 -mt-3 text-zinc-600 items-center gap-1">
                                    <div class="rounded bg-[#10B981] w-1 h-2"></div>
                                    used
                                    <div class="rounded bg-[#085b3f] w-1 h-2 ml-2"></div>
                                    available
                                </div>
                            </div>
                            <p class="px-5 text-sm text-zinc-300">{{ current_memory_used }}/{{
                                current_memory_available
                                }} <span class="text-zinc-500">MiB</span></p>
                        </div>
                        <div id="memory_used_and_available_chart" class="w-full h-full"></div>
                    </div>
                    <div class="graph_container">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="graph_title">Network traffic (Mbps)</p>
                                <div class="flex text-xxs px-4 -mt-3 text-zinc-600 items-center gap-1">
                                    <div class="rounded bg-[#10B981] w-1 h-2"></div>
                                    transmit
                                    <div class="rounded bg-[#085b3f] w-1 h-2 ml-2"></div>
                                    received</p>
                                </div>
                            </div>
                            <p class="px-5 text-sm text-zinc-300">{{ current_transmit_bytes }}/{{
                                current_received_bytes
                                }} <span class="text-zinc-500">Mbps</span></p>
                        </div>
                        <div id="network_io_chart" class="w-full h-full"></div>
                    </div>
                </div>
            </div>
            <!-- request metrics -->
            <div>
                <p class="section_title">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6"
                        viewBox="0 0 24 24"><!-- Icon from Huge Icons by Hugeicons - undefined -->
                        <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                            stroke-width="1.5">
                            <path
                                d="M2.5 12c0-4.478 0-6.718 1.391-8.109S7.521 2.5 12 2.5c4.478 0 6.718 0 8.109 1.391S21.5 7.521 21.5 12c0 4.478 0 6.718-1.391 8.109S16.479 21.5 12 21.5c-4.478 0-6.718 0-8.109-1.391S2.5 16.479 2.5 12" />
                            <path
                                d="M6 13.5L7.5 9l1.875 4.5M6 13.5L5.5 15m.5-1.5h3.375m0 0L10 15m2.5-3V9.7c0-.186 0-.28.024-.355a.5.5 0 0 1 .322-.32C12.92 9 13.013 9 13.2 9h1.3a1.5 1.5 0 0 1 0 3zm0 0v3m6-6v6" />
                        </g>
                    </svg>
                    Request Metrics
                </p>
                <div class="grid grid-cols-6 gap-2 px-2 lg:grid-cols-12">
                    <div class="col-span-6 lg:col-span-4 graph_container">
                        <div class="flex items-center justify-between">
                            <p class="graph_title">Requests per minute (status code)</p>
                            <div class="flex gap-4 pr-4 text-xs text-zinc-400">
                                <div class="flex gap-1 items-center">
                                    <div class="rounded bg-[#64748b] w-3 h-3"></div>
                                    <p class="pt-1">1XX</p>
                                </div>
                                <div class="flex gap-1 items-center">
                                    <div class="rounded bg-[#10B981] w-3 h-3"></div>
                                    <p class="pt-1">2XX</p>
                                </div>
                                <div class="flex gap-1 items-center">
                                    <div class="rounded bg-[#eab308] w-3 h-3"></div>
                                    <p class="pt-1">3XX</p>
                                </div>
                                <div class="flex gap-1 items-center">
                                    <div class="rounded bg-[#f97316] w-3 h-3"></div>
                                    <p class="pt-1">4XX</p>
                                </div>
                                <div class="flex gap-1 items-center">
                                    <div class="rounded bg-[#ef4444] w-3 h-3"></div>
                                    <p class="pt-1">5XX</p>
                                </div>
                            </div>
                        </div>
                        <div id="request_per_minute_chart" class="w-full h-full"></div>
                    </div>
                    <div class="col-span-6 lg:col-span-4 graph_container">
                        <div class="flex items-center justify-between">
                            <p class="graph_title">Read/Write per minute</p>
                            <div class="flex gap-4 pr-4 text-xs text-zinc-400">
                                <div class="flex gap-1 items-center">
                                    <div class="rounded bg-[#10B981] w-3 h-3"></div>
                                    <p class="pt-1">READ</p>
                                </div>
                                <div class="flex gap-1 items-center">
                                    <div class="rounded bg-[#3D3F9C] w-3 h-3"></div>
                                    <p class="pt-1">WRITE</p>
                                </div>
                            </div>
                        </div>
                        <div id="read_write_per_minute_chart" class="w-full h-full"></div>
                    </div>
                    <div class="col-span-4 lg:col-span-3 graph_container">
                        <p class="graph_title">Top 5 Transactions (%)</p>
                        <p class="text-xxs px-4 -mt-2 text-zinc-600">in the last 30 minutes</p>
                        <div class="text-xs px-4 pt-3">
                            <div v-for="(val, key) of top_routes">
                                <div class="mb-1 font-medium text-zinc-300 flex justify-between">
                                    <p>{{ key }}</p>
                                    <p class="font-bold"> {{ Math.round((val * 100) / top_routes_total) }}%</p>
                                </div>
                                <div class="w-full rounded-full h-2 mb-4 bg-zinc-700">
                                    <div class="h-2 rounded-full bg-zinc-300"
                                        :style="{ width: Math.round((val * 100) / Math.max(...Object.values(top_routes))) + '%' }">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-span-2 lg:col-span-1 graph_container">
                        <p class="graph_title">Requests per method</p>
                        <div class="w-full h-full flex flex-col gap-1 px-3">
                            <div class="px-2 py-2 border-l-4 border-[#10B981] flex justify-between">
                                <p class="text-zinc-400">GET</p>
                                <p class="font-semibold">{{ requests_per_method_count.GET }}</p>
                            </div>
                            <div class="px-2 py-2 border-l-4 border-blue-400 flex justify-between">
                                <p class="text-zinc-400">POST</p>
                                <p class="font-semibold">{{ requests_per_method_count.POST }}</p>
                            </div>
                            <div class="px-2 py-2 border-l-4 border-yellow-400 flex justify-between">
                                <p class="text-zinc-400">PUT</p>
                                <p class="font-semibold">{{ requests_per_method_count.PUT }}</p>
                            </div>
                            <div class="px-2 py-2 border-l-4 border-yellow-400 flex justify-between">
                                <p class="text-zinc-400">PATCH</p>
                                <p class="font-semibold">{{ requests_per_method_count.PATCH }}</p>
                            </div>
                            <div class="px-2 py-2 border-l-4 border-red-400 flex justify-between">
                                <p class="text-zinc-400">DELETE</p>
                                <p class="font-semibold">{{ requests_per_method_count.DELETE }}</p>
                            </div>
                            <div class="px-2 py-2 border-l-4 border-zinc-400 flex justify-between">
                                <p class="text-zinc-400">OPTION</p>
                                <p class="font-semibold">{{ requests_per_method_count.OPTION }}</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-span-6 lg:col-span-12 px-4 py-2 graph_container">
                        <div class="text-zinc-400 w-full flex justify-between items-center">
                            <p>showing 1-4 of 4</p>
                            <div class="border border-zinc-800 rounded px-2 py-1 mb-2 w-1/2 flex gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="text-zinc-700 w-5 h-5"
                                    viewBox="0 0 24 24"><!-- Icon from Material Symbols by Google - https://github.com/google/material-design-icons/blob/master/LICENSE -->
                                    <path fill="currentColor"
                                        d="m19.6 21l-6.3-6.3q-.75.6-1.725.95T9.5 16q-2.725 0-4.612-1.888T3 9.5t1.888-4.612T9.5 3t4.613 1.888T16 9.5q0 1.1-.35 2.075T14.7 13.3l6.3 6.3zM9.5 14q1.875 0 3.188-1.312T14 9.5t-1.312-3.187T9.5 5T6.313 6.313T5 9.5t1.313 3.188T9.5 14" />
                                </svg>
                                <input type="text" class="w-full placeholder:text-zinc-700" placeholder="search routes">
                            </div>
                        </div>
                        <div class="w-full text-left pt-2 border-t border-zinc-800">
                            <table class="w-full table-fixed border-separate border-spacing-2">
                                <tr>
                                    <th>ENDPOINT</th>
                                    <th>LAST CALLED</th>
                                    <th>TOTAL CALL COUNT</th>
                                    <th>REQUESTS/MIN</th>
                                    <th>ERROR RATE</th>
                                    <th>P99 LATENCY</th>
                                </tr>
                                <tr v-for="item in tableRows" :key="item.id">
                                    <td>{{ item.route }}</td>
                                    <td>
                                        {{ new Date(item.last_called).toLocaleTimeString([], {
                                        hour: "2-digit",
                                        minute: "2-digit",
                                        }) }}
                                    </td>
                                    <td>{{ item.total_call_count }}</td>
                                    <td>{{ item.requests_per_min }}</td>
                                    <td>{{ item.total_error_count }} {{ item.error_rate }}</td>
                                    <td>{{ `${item.p99_latency.toFixed(2)} ms` }}</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <!-- latency metrics -->
            <div>
                <p class="section_title">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6"
                        viewBox="0 0 24 24"><!-- Icon from Material Symbols by Google - https://github.com/google/material-design-icons/blob/master/LICENSE -->
                        <path fill="currentColor"
                            d="M9 3V1h6v2zm3 19q-1.875 0-3.512-.712T5.625 19.35T3.7 16.487T3 13t.713-3.488T5.65 6.65t2.863-1.937T12 4q1.575 0 3 .525T17.6 6l1.45-1.45l1.4 1.4l-1.4 1.45q.9 1.175 1.425 2.6T21 13q0 1.85-.7 3.488t-1.925 2.862t-2.863 1.938T12 22m0-11h6.7q-.45-1.55-1.537-2.725T14.6 6.5zm-1.75 1l3.35-5.8q-1.475-.375-3.037-.063T7.65 7.5zM5.1 14h5.15L6.9 8.2q-1.05 1.175-1.562 2.663T5.1 14m4.3 5.5L12 15H5.3q.45 1.55 1.538 2.725T9.4 19.5m1 .3q1.65.425 3.2.038t2.75-1.338l-2.6-4.5zm6.7-2q1.1-1.2 1.588-2.687T18.9 12h-5.15z" />
                    </svg>
                    Latency Metrics
                </p>
                <div class="grid grid-cols-6 gap-2 px-2 lg:grid-cols-10">
                    <div class="col-span-4 lg:col-span-7 graph_container">
                        <div class="flex justify-between">
                            <p class="graph_title">Latency per route (ms)</p>
                            <div class="graph_title text-right">
                                <div class="text-xxs pb-1 text-zinc-700">
                                    <button class="text-zinc-600">P99</button> |
                                    <button class="text-zinc-300 font-bold">P90</button> |
                                    <button class="text-zinc-600">P50</button>
                                </div>
                            </div>
                        </div>
                        <div id="latency_per_route_chart" class="w-full h-full"></div>
                    </div>
                    <div class="col-span-2 lg:col-span-3 graph_container">
                        <div>
                            <p class="graph_title">Top 5 slowest requests</p>
                            <p class="flex text-xxs px-4 -mt-2 text-zinc-600 items-center gap-1">average P99 in last 30
                                minutes</p>
                        </div>
                        <div class="text-xs px-4 pt-3">
                            <div v-for="(val, key) in top_slowest_routes">
                                <div class="mb-1 font-medium text-zinc-300 flex justify-between">
                                    <p>{{ key }}</p>
                                    <p class="font-bold">{{ formatTime(val, true) }}</p>
                                </div>
                                <div class="w-full rounded-full h-2 mb-4 bg-zinc-700">
                                    <div class="h-2 rounded-full bg-zinc-300"
                                        :style="{ width: Math.round((val*100)/Math.max(...Object.values(top_slowest_routes)))  + '%' }">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- error metrics -->
                <div>
                    <p class="section_title">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5"
                            viewBox="0 0 24 24"><!-- Icon from Google Material Icons by Material Design Authors - https://github.com/material-icons/material-icons/blob/master/LICENSE -->
                            <path fill="currentColor"
                                d="M21 18c-.55 0-1-.45-1-1v-6c0-.55.45-1 1-1s1 .45 1 1v6c0 .55-.45 1-1 1m0 2c-.55 0-1 .45-1 1s.45 1 1 1s1-.45 1-1s-.45-1-1-1m-3-2.71A8 8 0 0 1 12 20c-4.41 0-8-3.59-8-8s3.59-8 8-8v9l7.55-7.55A9.97 9.97 0 0 0 12 2C6.48 2 2 6.48 2 12s4.48 10 10 10c2.25 0 4.33-.74 6-2z" />
                        </svg>
                        Error Metrics
                    </p>
                    <div class="grid grid-cols-6 gap-2 px-2 lg:grid-cols-10">
                        <div class="col-span-4 lg:col-span-7 graph_container">
                            <div class="flex justify-between">
                                <p class="graph_title">Error per route (ms)</p>
                                <div class="flex gap-4 pr-4 text-xs text-zinc-400">
                                    <div class="flex gap-1 items-center">
                                        <div class="rounded bg-[#f97316] w-3 h-3"></div>
                                        <p class="pt-1">4XX</p>
                                    </div>
                                    <div class="flex gap-1 items-center">
                                        <div class="rounded bg-[#ef4444] w-3 h-3"></div>
                                        <p class="pt-1">5XX</p>
                                    </div>
                                </div>
                            </div>
                            <div id="error_requests_chart" class="w-full h-full"></div>
                        </div>
                        <div class="col-span-2 lg:col-span-3 graph_container">
                            <div>
                                <p class="graph_title">Top 5 Error prone requests</p>
                                <p class="flex text-xxs px-4 -mt-2 text-zinc-600 items-center gap-1">error count in the
                                    last 30 minutes</p>
                            </div>
                            <div class="text-xs px-4 pt-3">
                                <div v-for="(val, key) in top_error_prone_routes">
                                    <div class="mb-1 font-medium text-zinc-300 flex justify-between">
                                        <p>{{ key }}</p>
                                        <p class="font-bold">{{ val }}</p>
                                    </div>
                                    <div class="w-full rounded-full h-2 mb-4 bg-zinc-700">
                                        <div class="h-2 rounded-full bg-zinc-300"
                                            :style="{ width: Math.round((val*100)/Math.max(...Object.values(top_error_prone_routes)))  + '%' }">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- footer -->
                <div class="flex justify-between p-6 mt-10 text-xs text-zinc-300">
                    <p>
                        made by <a class="underline" target="_blank" href="https://hamzadellam.com">HamzaDLM</a>
                    </p>
                    <!-- TODO: -->
                    <a href="github.com/HamzaDLM/fastapi-metrics-dashboard" target="_blank"
                        class="flex items-center gap-2 hover:underline">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5"
                            viewBox="-2 -2 24 24"><!-- Icon from Jam Icons by Michael Amprimo - https://github.com/cyberalien/jam-backup/blob/main/LICENSE -->
                            <path fill="currentColor"
                                d="M18.88 1.099Q17.78-.001 16.233 0H3.746Q2.198 0 1.099 1.099Q-.001 2.199 0 3.746v12.487q0 1.548 1.099 2.647q1.1 1.1 2.647 1.099H6.66q.285 0 .429-.02a.5.5 0 0 0 .286-.169q.143-.15.143-.435l-.007-.885q-.006-.846-.006-1.34l-.3.052q-.285.052-.721.046a5.6 5.6 0 0 1-.904-.091a2 2 0 0 1-.872-.39a1.65 1.65 0 0 1-.572-.8l-.13-.3a3.3 3.3 0 0 0-.41-.663q-.28-.364-.566-.494l-.09-.065a1 1 0 0 1-.17-.156a.7.7 0 0 1-.117-.182q-.039-.092.065-.15q.104-.06.378-.059l.26.04q.26.051.643.311a2.1 2.1 0 0 1 .631.677q.3.532.722.813q.423.28.852.28t.742-.065a2.6 2.6 0 0 0 .585-.196q.117-.871.637-1.34a9 9 0 0 1-1.333-.234a5.3 5.3 0 0 1-1.223-.507a3.5 3.5 0 0 1-1.047-.872q-.416-.52-.683-1.365q-.266-.846-.266-1.952q0-1.573 1.027-2.68q-.48-1.183.091-2.652q.378-.118 1.119.175t1.086.5q.345.21.553.352a9.2 9.2 0 0 1 2.497-.338q1.288 0 2.498.338l.494-.312a7 7 0 0 1 1.197-.572q.689-.26 1.054-.143q.585 1.47.103 2.653q1.028 1.105 1.028 2.68q0 1.106-.267 1.957q-.266.852-.689 1.366a3.7 3.7 0 0 1-1.053.865q-.63.351-1.223.507a9 9 0 0 1-1.333.235q.675.585.676 1.846v3.11q0 .22.065.357a.36.36 0 0 0 .208.189q.143.052.254.064q.111.014.318.013h2.914q1.548 0 2.647-1.099t1.099-2.647V3.746q0-1.548-1.1-2.647z" />
                        </svg>
                        fastapi-metrics-dashboard
                    </a>
                </div>
            </div>
        </div>

        <script src="./main.js"></script>
</body>

</html>